<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title><%= rest.name %> | è©³æƒ…</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/index.css">
    <link rel="stylesheet" href="/detail.css">
</head>

<body>
    <!-- å°è¦½åˆ—ï¼Œé» logo å›é¦–é  -->
    <nav>
        <a href="/" class="logo">åŸå¸‚é¤æ¡Œ</a>
    </nav>

    <!-- ä¸»å…§å®¹å®¹å™¨ -->
    <div class="container">

        <!-- ä¸ŠåŠéƒ¨ï¼šåœ–ç‰‡ + é¤å»³è³‡è¨Š -->
        <div class="detail-flex">

            <!-- é¤å»³åœ–ç‰‡å€ -->
            <div style="flex:1; min-width:320px; border-radius:20px;
                        overflow:hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
                <img src="<%= rest.image_url %>"
                     alt="<%= rest.name %>"
                     style="width:100%; display:block;">
            </div>

            <!-- å³å´è³‡è¨Šæ¬„ -->
            <div class="info-panel">

                <!-- é¤å»³åç¨± -->
                <h1><%= rest.name %></h1>

                <!-- æ¨è–¦æè¿° -->
                <p class="description"><%= rest.description %></p>

                <!-- åˆ†éš”ç·š -->
                <hr style="border:0; border-top:1px solid #f2f2f2; margin:20px 0;">

                <!-- åœ°å€èˆ‡é›»è©± -->
                <p>ğŸ“ åœ°å€ï¼š<%= rest.address %></p>
                <p>ğŸ“ é›»è©±ï¼š<%= rest.phone %></p>

                <!-- åŠŸèƒ½æŒ‰éˆ• -->
                <div class="btn-group">

                    <!-- Google åœ°åœ–å°èˆª -->
                    <a href="https://www.google.com/maps/search/?api=1&query=<%= encodeURIComponent(rest.address) %>"
                       target="_blank"
                       class="btn btn-map">
                        åœ°åœ–å°èˆª
                    </a>

                    <!-- ç›´æ¥æ’¥æ‰“é›»è©±ï¼ˆæ‰‹æ©Ÿç”¨ï¼‰ -->
                    <a href="tel:<%= rest.phone %>"
                       class="btn btn-phone">
                        æ’¥æ‰“é›»è©±
                    </a>
                </div>
            </div>
        </div>

        <!-- ç•™è¨€å€ -->
        <div class="comment-section">
            <h3>ğŸ’¬ ç•™è¨€è©•è«–</h3>

            <!-- ç•™è¨€æ¸…å–® -->
            <div id="commentList">

                <!-- EJSï¼šå€’åºé¡¯ç¤ºç•™è¨€ï¼ˆæœ€æ–°åœ¨æœ€ä¸Šé¢ï¼‰ -->
                <% rest.comments.reverse().forEach(c => { %>
                    <div class="comment-item">
                        <%= c.text %>
                        <small style="float:right;"><%= c.date %></small>
                    </div>
                <% }) %>

            </div>

            <!-- ç•™è¨€è¼¸å…¥å€ -->
            <div class="input-group">
                <input type="text" id="msg" placeholder="åˆ†äº«ä½ çš„é£Ÿè¨˜...">
                <button onclick="sendMsg()" class="btn-send">é€å‡º</button>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        // é€å‡ºç•™è¨€
        async function sendMsg() {

            // å–å¾—è¼¸å…¥çš„ç•™è¨€æ–‡å­—
            const text = document.getElementById('msg').value;

            // å¦‚æœæ²’è¼¸å…¥å…§å®¹å°±ä¸é€å‡º
            if (!text) return;

            // å‘¼å«å¾Œç«¯ APIï¼Œæ–°å¢ç•™è¨€
            await fetch(`/api/restaurants/<%= rest.id %>/comments`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ text })
            });

            // é‡æ–°æ•´ç†é é¢ï¼Œé¡¯ç¤ºæœ€æ–°ç•™è¨€
            location.reload();
        }
    </script>
</body>
</html>
