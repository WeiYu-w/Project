<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>é£Ÿå…‰åœ°åœ– | æ¢ç´¢å…¨å°ç¾é£Ÿ</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/index.css">
</head>
<body>
    <!-- å°è¦½åˆ— -->
    <nav>
        <a href="/" class="logo">å…¨å°é£Ÿå…‰åœ°åœ–</a>
        <a href="/post"
           style="background:var(--sage); color:white; padding:8px 20px;
                  border-radius:50px; text-decoration:none; font-size:14px;">
            æˆ‘è¦æŠ•ç¨¿
        </a>
    </nav>

    <!-- æœç´¢ -->
    <form action="/" method="get" style="margin:20px 0; text-align:center;">
        <!-- é—œéµå­—æœå°‹ -->
        <input type="text" name="q" value="<%= q %>" placeholder="æœå°‹é¤å»³..." style="padding:10px 15px; width:200px; border-radius:10px; border:1px solid #ccc;">

        <!-- å€åŸŸé¸å–® -->
        <select name="region" id="regionSelect" style="padding:10px 15px; border-radius:10px; border:1px solid #ccc;">
            <option value="">å…¨éƒ¨å€åŸŸ</option>
            <option value="åŒ—" <%= region==='åŒ—'?'selected':'' %>>åŒ—éƒ¨</option>
            <option value="ä¸­" <%= region==='ä¸­'?'selected':'' %>>ä¸­éƒ¨</option>
            <option value="å—" <%= region==='å—'?'selected':'' %>>å—éƒ¨</option>
            <option value="æ±" <%= region==='æ±'?'selected':'' %>>æ±éƒ¨</option>
            <option value="å¤–å³¶" <%= region==='å¤–å³¶'?'selected':'' %>>å¤–å³¶</option>
        </select>

        <!-- åŸå¸‚ä¸‹æ‹‰ -->
        <select name="city" id="citySelect" style="padding:10px 15px; border-radius:10px; border:1px solid #ccc;">
            <option value="">å…¨éƒ¨åŸå¸‚</option>
        </select>

        <button type="submit" style="padding:10px 15px; border:none; background:var(--sage); color:white; border-radius:10px; cursor:pointer;">
            æœå°‹
        </button>
    </form>

    <!-- JS: æ ¹æ“šå€åŸŸæ›´æ–°åŸå¸‚ -->
    <script>
        const citiesByRegion = {
            "åŒ—": ["å°åŒ—å¸‚","æ–°åŒ—å¸‚","æ¡ƒåœ’å¸‚","åŸºéš†å¸‚","æ–°ç«¹å¸‚","æ–°ç«¹ç¸£","å®œè˜­ç¸£"],
            "ä¸­": ["å°ä¸­å¸‚","è‹—æ —ç¸£","å½°åŒ–ç¸£","å—æŠ•ç¸£","é›²æ—ç¸£"],
            "å—": ["é«˜é›„å¸‚","å°å—å¸‚","å˜‰ç¾©å¸‚","å˜‰ç¾©ç¸£","å±æ±ç¸£","æ¾æ¹–ç¸£"],
            "æ±": ["èŠ±è“®ç¸£","å°æ±ç¸£"],
            "å¤–å³¶": ["é‡‘é–€ç¸£","é€£æ±Ÿç¸£"]
        };

        const regionSelect = document.getElementById('regionSelect');
        const citySelect = document.getElementById('citySelect');

        function updateCities() {
            const region = regionSelect.value;
            citySelect.innerHTML = '<option value="">å…¨éƒ¨åŸå¸‚</option>';
            if(region && citiesByRegion[region]) {
                citiesByRegion[region].forEach(c => {
                    const selected = "<%= city %>" === c ? 'selected' : '';
                    const option = `<option value="${c}" ${selected}>${c}</option>`;
                    citySelect.innerHTML += option;
                });
            }
        }

        updateCities();
        regionSelect.addEventListener('change', () => {
            citySelect.value = '';
            updateCities();
        });
    </script>

    <!-- ä¸»é¤å»³åˆ—è¡¨ -->
    <div class="container">
        <div class="grid">
            <% restaurants.forEach(r => { %>
                <div class="rest-card" onclick="location.href='/detail/<%= r.id %>'">
                    <div class="ig-placeholder" style="height:250px;">
                        <img src="<%= r.image_url %>" alt="<%= r.name %>" style="width:100%; height:100%; object-fit:cover;">
                    </div>
                    <div class="card-content">
                        <span class="tag"><%= r.city %></span>
                        <span class="tag"><%= r.district %></span>
                        <h4><%= r.name %></h4>
                        <p class="address-text">ğŸ“ <%= r.address %></p>
                    </div>
                </div>
            <% }) %>
        </div>
    </div>
</body>
</html>